ServerRoot "/usr/local/apache2"
PidFile /var/run/apache2.pid

LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule headers_module modules/mod_headers.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
LoadModule rewrite_module modules/mod_rewrite.so

ServerName localhost

<IfModule unixd_module>
User daemon
Group daemon
</IfModule>

DocumentRoot "/usr/local/apache2/htdocs"

<Directory "/usr/local/apache2/htdocs">
    Require all granted
    Options Indexes FollowSymLinks
    AllowOverride None
</Directory>

ErrorLog /proc/self/fd/2
CustomLog /proc/self/fd/1 common

# Enable rewrite for SPA routing (serve index.html for non-file requests)
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^ /index.html [L]

ProxyRequests Off
ProxyPreserveHost On

# Proxy API requests to backend 'server' (network alias expected)
ProxyPass /api/ http://server:4000/
ProxyPassReverse /api/ http://server:4000/

# WebSocket proxy
ProxyPass /ws ws://server:4000/ws
ProxyPassReverse /ws ws://server:4000/ws

# Serve uploads via backend
ProxyPass /uploads/ http://server:4000/uploads/
ProxyPassReverse /uploads/ http://server:4000/uploads/

# DirectoryIndex
<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>

# Listen on port 80
Listen 80
